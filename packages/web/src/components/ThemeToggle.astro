---
import Icon from "./Icon.astro";
---

<button id="theme-toggle">
    <Icon class="dark" name="sun" />
    <Icon class="light" name="moon" />
</button>

<script is:inline>
    const localStorageTheme = localStorage.getItem("theme") ?? "";
    const theme =
        localStorageTheme === "dark" || localStorageTheme === "light"
            ? localStorageTheme
            : window.matchMedia("(prefers-color-scheme: dark)").matches
              ? "dark"
              : "light";
    const opposite = theme === "dark" ? "light" : "dark";

    document.documentElement.classList.remove(`${opposite}-theme`);
    document.documentElement.classList.add(`${theme}-theme`);

    window.localStorage.setItem("theme", theme);

    document.getElementById("theme-toggle").addEventListener("click", function () {
        const element = document.documentElement;
        element.classList.toggle("light-theme");
        element.classList.toggle("dark-theme");

        const isDark = element.classList.contains("dark-theme");
        localStorage.setItem("theme", isDark ? "dark" : "light");
    });
</script>

<style>
    button#theme-toggle {
        display: flex;
        align-items: center;

        padding: 0 1.5rem;

        cursor: pointer;

        background-color: transparent;
        color: var(--text-primary);
        border-radius: 0;
        border: none;
        outline: none;
        font-size: 120%;

        transition: background-color 100ms;
    }

    button#theme-toggle:hover {
        background-color: var(--nav-button-hover);
    }
</style>
